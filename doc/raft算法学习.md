# 分布式一致性算法：Raft学习

## 什么是分布式系统？

分布式系统是由一组通过网络进行通信、为了完成共同的任务而协调工作的计算机节点组成的系统。这些节点可能位于不同的物理位置，但它们协同工作以提供一个统一的计算平台或服务。分布式系统的出现是为了用廉价的、普通的机器完成单个计算机无法完成的计算、存储任务。其目的是利用更多的机器，处理更多的数据。例如，分布式计算系统、分布式存储系统（缓存、数据库、文件）等。

> 分布式和集群的区别
>
> - 分布式是指**多个系统协同合作完成一个特定任务的系统**。是**不同的系统**部署在不同的服务器上，服务器之间相互调用。主要工作是分解任务，把职能拆解，解决中心化管理。
> - 集群是指**在几个服务器上部署相同的应用程序来分担客户端的请求**。是**同一个系统**部署在不同的服务器上，比如一个登陆系统部署在不同的服务器上。使用场景是为了分担请求的压力。

![98ef710d2882cb08df2a48562547178c.png](F:\学习\研二\学习\cpp项目\figures\分布式示例.png)

**分布式系统面临的挑战：**

- 网络延迟和分区

  节点间通过网络通信，而网络是不可靠的。可能的网络问题包括：网络分割、延时、丢包、乱序，网络的不可靠性和延迟可能导致节点之间的通信问题理。

- 普遍的节点故障

  虽然单个节点的故障概率较低，但节点数目达到一定规模，出故障的概率就变高了。分布式系统需要保证故障发生的时候，系统仍然是可用的，这就需要监控节点的状态，在节点故障的情况下将该节点负责的计算、存储任务转移到其他节点。

- 异构的机器与网络

  分布式系统中的机器，配置不一样，其上运行的服务也可能由不同的语言、架构实现，因此处理能力也不一样；节点间通过网络连接，而不同网络运营商提供的网络的带宽、延时、丢包率又不一样。怎么保证大家齐头并进，共同完成目标，这是个不小的挑战。

## CAP理论

- **C consistency 一致性**

- 在分布式系统中有多个节点，整个系统对外提供的服务应该是一致的。即用户**在不同的系统节点访问数据的时候应该是同样的结果**，不能出现1号节点是结果1， 2号节点是结果2这种不一致的情况。

- **A availability 可用性**

  分布式系统为用户提供服务，需要保证能够**在一些节点异常的情况下仍然支持为用户提供服务**。

- **P partition tolerance 分区容错性（容灾）**

- 分布式系统的部署可能跨省，甚至跨国。不同省份或者国家之间的服务器节点是通过网络进行连接，此时如果**两个地域之间的网络连接断开，整个分布式系统的体现就是分区容错性了**。在这种系统出现网络分区的情况下系统的服务就**需要在一致性 和 可用性之间进行取舍**。要么保持一致性，返回错误。要么是保证可用性，使得两个地域之间的分布式系统不一致。

![image (4)](F:\学习\研二\学习\cpp项目\figures\CAP.png)

==**CAP理论一定是无法全部满足三者，只能满足其中的两者（CA、CP、AP）。**==

对于一个分布式系统而言，**<font color='red'>P是分布式的前提，必须保证</font>，因为只要有网络交互就一定会有延迟和数据丢失，这种状况我们必须接受，必须保证系统不能挂掉**。所以只剩下C、A可以选择。要么保证数据一致性（保证数据绝对正确），要么保证可用性（保证系统不出错）。

当选择了C（一致性）时，如果由于网络分区而无法保证特定信息是最新的，则系统将<font color='cornflowerblue'>**返回错误或超时**</font>。

当选择了A（可用性）时，系统将始终处理客户端的查询并尝试返回**最新的<font color='cornflowerblue'>可用的信息版本</font>**，即使由于网络分区而**无法保证其是最新的**。

## 分布一致性

一致性可以分为弱一致性和强一致性。

- **弱一致性 **（例如：DNS域名系统）

  弱一致性体现的是最终一致性，即如上CAP理论中 ，两个地域的请求分别通过两地的节点写入，可以不用立即进行同步，而是**经过一段时间之后两地的用户数据变为一致**。这种一致性成为弱一致性，即最终一致性。 也就是用户一地写入之后**从另外一个节点读取，无法立即读到刚才写入的数据**。

- **强一致性 **（又被称为共识，例如：银行系统）

  强一致性描述的是一个请求在一个节点写入之后在其他节点读取，则**该数据的更新能够被立刻读到**。





## 强一致性（共识）算法







## 参考文献

[什么是分布式系统，这么讲不信你不会 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/99932839)

[什么是分布式，分布式和集群的区别又是什么？这一篇让你彻底明白！_什么叫分布式-CSDN博客](https://blog.csdn.net/weixin_42046751/article/details/109510811)

[终于有人把分布式系统架构讲明白了-CSDN博客](https://blog.csdn.net/hzbooks/article/details/120916132)